<!doctype html>
<html lang="en">
  <head>
    {{> head title="Vector Maps - ElaAdmin"}}
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
      .map-container {
        height: 400px;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
      }
      
      .stats-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
        min-width: 200px;
      }
      
      .stats-overlay h6 {
        margin-bottom: 10px;
        color: #495057;
      }
      
      .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
      }
      
      .stat-item:last-child {
        margin-bottom: 0;
        padding-top: 8px;
        border-top: 1px solid #e9ecef;
        font-weight: 600;
      }
      
      .chart-container {
        position: relative;
        height: 300px;
        padding: 20px;
      }
      
      .geo-chart {
        height: 400px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }
      
      .geo-visualization {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }
      
      .data-point {
        position: absolute;
        width: 12px;
        height: 12px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        animation: pulse 2s infinite;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .data-point:hover {
        transform: scale(1.5);
        background: #fff;
      }
      
      @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
      }
      
      .region-selector {
        margin-bottom: 20px;
      }
      
      .region-btn {
        margin-right: 10px;
        margin-bottom: 5px;
      }
      
      .leaflet-container {
        border-radius: 8px;
      }
      
      .map-legend {
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }
      
      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }
      
      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 3px;
        margin-right: 10px;
      }
      
      .heatmap-demo {
        background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
        background-size: 400% 400%;
        animation: gradientShift 8s ease infinite;
        height: 300px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        text-align: center;
      }
      
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    </style>
  </head>

  <body>
    {{> sidebar-ela}}
    {{> header-ela}}

    <div id="right-panel" class="right-panel main-content">
      <div class="content">
        <div class="container-fluid">
          <!-- Page Header -->
          <div class="row mb-4">
            <div class="col-sm-6">
              <h4 class="page-title">Vector Maps & Visualizations</h4>
              <p class="text-muted">Interactive maps and geographic data visualization</p>
            </div>
            <div class="col-sm-6">
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
                  <li class="breadcrumb-item"><a href="#">Maps</a></li>
                  <li class="breadcrumb-item active">Vector Maps</li>
                </ol>
              </nav>
            </div>
          </div>

          <!-- Interactive World Map -->
          <div class="row mb-4">
            <div class="col-lg-12">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-globe me-2"></i>Interactive World Map</h5>
                </div>
                <div class="card-body">
                  <div class="region-selector">
                    <button class="btn btn-sm btn-outline-primary region-btn" onclick="setMapView(51.505, -0.09, 10)">London</button>
                    <button class="btn btn-sm btn-outline-primary region-btn" onclick="setMapView(40.7128, -74.0060, 10)">New York</button>
                    <button class="btn btn-sm btn-outline-primary region-btn" onclick="setMapView(35.6762, 139.6503, 10)">Tokyo</button>
                    <button class="btn btn-sm btn-outline-primary region-btn" onclick="setMapView(-33.8688, 151.2093, 10)">Sydney</button>
                    <button class="btn btn-sm btn-outline-primary region-btn" onclick="setMapView(20, 0, 2)">World</button>
                  </div>
                  <div id="worldMap" class="map-container">
                    <div class="stats-overlay">
                      <h6><i class="fas fa-chart-line me-1"></i>Live Stats</h6>
                      <div class="stat-item">
                        <span>Active Users:</span>
                        <span class="text-success">2,847</span>
                      </div>
                      <div class="stat-item">
                        <span>Page Views:</span>
                        <span class="text-info">18,392</span>
                      </div>
                      <div class="stat-item">
                        <span>Sessions:</span>
                        <span class="text-warning">1,256</span>
                      </div>
                      <div class="stat-item">
                        <span>Total Revenue:</span>
                        <span class="text-primary">$43,291</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Regional Data Visualization -->
          <div class="row mb-4">
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Regional Sales Data</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="regionalChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-map-marked-alt me-2"></i>Geographic Distribution</h5>
                </div>
                <div class="card-body">
                  <div id="geoDistributionMap" class="map-container">
                    <!-- This will be another Leaflet map with markers -->
                  </div>
                  <div class="map-legend">
                    <div class="legend-item">
                      <div class="legend-color" style="background: #007bff;"></div>
                      <span>High Activity (&gt;1000 users)</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color" style="background: #28a745;"></div>
                      <span>Medium Activity (500-1000 users)</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color" style="background: #ffc107;"></div>
                      <span>Low Activity (&lt;500 users)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Heat Map and Traffic Flow -->
          <div class="row mb-4">
            <div class="col-lg-8">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-fire me-2"></i>Traffic Heat Map</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="heatmapChart"></canvas>
                  </div>
                  <div class="row mt-3">
                    <div class="col-4 text-center">
                      <div class="h5 text-primary">2,847</div>
                      <small class="text-muted">Active Sessions</small>
                    </div>
                    <div class="col-4 text-center">
                      <div class="h5 text-success">18K</div>
                      <small class="text-muted">Page Views</small>
                    </div>
                    <div class="col-4 text-center">
                      <div class="h5 text-info">94.2%</div>
                      <small class="text-muted">Uptime</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card h-100">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Traffic Sources</h5>
                </div>
                <div class="card-body">
                  <div class="chart-container">
                    <canvas id="trafficChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Geographic Metrics -->
          <div class="row mb-4">
            <div class="col-lg-3 col-md-6">
              <div class="card bg-primary text-white">
                <div class="card-body text-center">
                  <i class="fas fa-globe fa-3x mb-3 opacity-75"></i>
                  <h3 class="mb-2">127</h3>
                  <p class="mb-0">Countries Served</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6">
              <div class="card bg-success text-white">
                <div class="card-body text-center">
                  <i class="fas fa-map-marker-alt fa-3x mb-3 opacity-75"></i>
                  <h3 class="mb-2">1,847</h3>
                  <p class="mb-0">Active Locations</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6">
              <div class="card bg-warning text-white">
                <div class="card-body text-center">
                  <i class="fas fa-users fa-3x mb-3 opacity-75"></i>
                  <h3 class="mb-2">89.2K</h3>
                  <p class="mb-0">Global Users</p>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-6">
              <div class="card bg-info text-white">
                <div class="card-body text-center">
                  <i class="fas fa-chart-line fa-3x mb-3 opacity-75"></i>
                  <h3 class="mb-2">+23.5%</h3>
                  <p class="mb-0">Growth Rate</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Data Table -->
          <div class="row mb-4">
            <div class="col-lg-12">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-table me-2"></i>Regional Performance Data</h5>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th><i class="fas fa-flag me-1"></i>Region</th>
                          <th><i class="fas fa-users me-1"></i>Users</th>
                          <th><i class="fas fa-eye me-1"></i>Sessions</th>
                          <th><i class="fas fa-clock me-1"></i>Avg. Duration</th>
                          <th><i class="fas fa-chart-line me-1"></i>Bounce Rate</th>
                          <th><i class="fas fa-dollar-sign me-1"></i>Revenue</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><span class="flag-icon me-2">🇺🇸</span>United States</td>
                          <td><span class="badge bg-primary">28,473</span></td>
                          <td>45,291</td>
                          <td>3m 42s</td>
                          <td><span class="text-success">34.2%</span></td>
                          <td class="text-success">$18,429</td>
                        </tr>
                        <tr>
                          <td><span class="flag-icon me-2">🇬🇧</span>United Kingdom</td>
                          <td><span class="badge bg-info">19,284</span></td>
                          <td>31,857</td>
                          <td>4m 15s</td>
                          <td><span class="text-success">28.9%</span></td>
                          <td class="text-success">$12,847</td>
                        </tr>
                        <tr>
                          <td><span class="flag-icon me-2">🇩🇪</span>Germany</td>
                          <td><span class="badge bg-warning">15,762</span></td>
                          <td>24,193</td>
                          <td>3m 28s</td>
                          <td><span class="text-warning">45.1%</span></td>
                          <td class="text-success">$9,382</td>
                        </tr>
                        <tr>
                          <td><span class="flag-icon me-2">🇫🇷</span>France</td>
                          <td><span class="badge bg-success">12,948</span></td>
                          <td>19,472</td>
                          <td>2m 58s</td>
                          <td><span class="text-success">38.7%</span></td>
                          <td class="text-success">$7,291</td>
                        </tr>
                        <tr>
                          <td><span class="flag-icon me-2">🇯🇵</span>Japan</td>
                          <td><span class="badge bg-secondary">8,473</span></td>
                          <td>13,829</td>
                          <td>5m 12s</td>
                          <td><span class="text-success">22.4%</span></td>
                          <td class="text-success">$5,847</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      {{> footer}}
    </div>

    {{> scripts}}

    <script>
      // Initialize Leaflet maps
      let map;
      let geoMap;
      
      function initializeMap() {
        // Main world map
        map = L.map('worldMap').setView([20, 0], 2);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Add markers for major cities
        const cities = [
          { name: 'New York', lat: 40.7128, lng: -74.0060, users: 28473 },
          { name: 'London', lat: 51.5074, lng: -0.1278, users: 19284 },
          { name: 'Tokyo', lat: 35.6762, lng: 139.6503, users: 15762 },
          { name: 'Paris', lat: 48.8566, lng: 2.3522, users: 12948 },
          { name: 'Berlin', lat: 52.5200, lng: 13.4050, users: 8473 },
          { name: 'Sydney', lat: -33.8688, lng: 151.2093, users: 6291 },
        ];

        cities.forEach(city => {
          const markerSize = Math.max(8, Math.min(25, city.users / 1000));
          const marker = L.circleMarker([city.lat, city.lng], {
            radius: markerSize,
            fillColor: '#007bff',
            color: '#fff',
            weight: 2,
            opacity: 1,
            fillOpacity: 0.7
          }).addTo(map);
          
          marker.bindPopup(`
            <strong>${city.name}</strong><br>
            Active Users: ${city.users.toLocaleString()}<br>
            <small>Click to view details</small>
          `);
        });
        
        // Initialize Geographic Distribution Map
        geoMap = L.map('geoDistributionMap').setView([30, 0], 2);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors'
        }).addTo(geoMap);
        
        // Add heat map-like circles for regions
        const regions = [
          { name: 'North America', lat: 45, lng: -100, users: 45000, color: '#007bff' },
          { name: 'Europe', lat: 50, lng: 10, users: 32000, color: '#28a745' },
          { name: 'Asia', lat: 30, lng: 100, users: 18000, color: '#ffc107' },
          { name: 'South America', lat: -15, lng: -60, users: 3000, color: '#17a2b8' },
          { name: 'Africa', lat: 0, lng: 20, users: 2000, color: '#dc3545' },
          { name: 'Australia', lat: -25, lng: 135, users: 5000, color: '#6610f2' }
        ];
        
        regions.forEach(region => {
          L.circle([region.lat, region.lng], {
            color: region.color,
            fillColor: region.color,
            fillOpacity: 0.5,
            radius: Math.sqrt(region.users) * 5000
          }).addTo(geoMap).bindPopup(`
            <strong>${region.name}</strong><br>
            Users: ${region.users.toLocaleString()}<br>
            ${(region.users / 1000).toFixed(1)}% of total
          `);
        });
      }

      function setMapView(lat, lng, zoom) {
        if (map) {
          map.setView([lat, lng], zoom);
        }
      }

      // Regional Chart
      function initializeRegionalChart() {
        const ctx = document.getElementById('regionalChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['North America', 'Europe', 'Asia Pacific', 'Latin America', 'Africa', 'Middle East'],
            datasets: [{
              label: 'Revenue ($K)',
              data: [450, 320, 280, 150, 75, 95],
              backgroundColor: [
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 99, 132, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(153, 102, 255, 0.8)',
                'rgba(255, 159, 64, 0.8)'
              ],
              borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1,
              borderRadius: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return '$' + value + 'K';
                  }
                }
              }
            }
          }
        });
      }

      // Traffic Sources Chart
      function initializeTrafficChart() {
        const ctx = document.getElementById('trafficChart').getContext('2d');
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Organic', 'Direct', 'Social', 'Referral', 'Email'],
            datasets: [{
              data: [45, 25, 15, 10, 5],
              backgroundColor: [
                '#28a745',
                '#007bff',
                '#fd7e14',
                '#6610f2',
                '#20c997'
              ],
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 15,
                  usePointStyle: true
                }
              }
            }
          }
        });
      }

      // Add tooltips to data points
      document.querySelectorAll('.data-point').forEach(point => {
        point.addEventListener('mouseenter', function(e) {
          const tooltip = this.getAttribute('data-tooltip');
          if (tooltip) {
            // Simple tooltip implementation
            const tooltipEl = document.createElement('div');
            tooltipEl.className = 'tooltip-custom';
            tooltipEl.innerHTML = tooltip;
            tooltipEl.style.cssText = `
              position: absolute;
              background: rgba(0,0,0,0.8);
              color: white;
              padding: 8px 12px;
              border-radius: 4px;
              font-size: 12px;
              z-index: 1000;
              pointer-events: none;
              top: ${e.pageY - 40}px;
              left: ${e.pageX - 50}px;
            `;
            document.body.appendChild(tooltipEl);
            this.tooltipEl = tooltipEl;
          }
        });

        point.addEventListener('mouseleave', function() {
          if (this.tooltipEl) {
            this.tooltipEl.remove();
            this.tooltipEl = null;
          }
        });
      });

      // Initialize Heatmap Chart
      function initializeHeatmapChart() {
        const ctx = document.getElementById('heatmapChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
            datasets: [{
              label: 'North America',
              data: [1200, 900, 1500, 2800, 2400, 2100, 1500],
              borderColor: '#007bff',
              backgroundColor: 'rgba(0, 123, 255, 0.1)',
              tension: 0.4,
              fill: true
            }, {
              label: 'Europe',
              data: [800, 1200, 2100, 2400, 1800, 1500, 1000],
              borderColor: '#28a745',
              backgroundColor: 'rgba(40, 167, 69, 0.1)',
              tension: 0.4,
              fill: true
            }, {
              label: 'Asia',
              data: [2100, 2400, 1800, 1500, 1800, 2400, 2200],
              borderColor: '#ffc107',
              backgroundColor: 'rgba(255, 193, 7, 0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              },
              title: {
                display: true,
                text: 'Traffic Density by Region (24h)'
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Active Users'
                }
              },
              x: {
                title: {
                  display: true,
                  text: 'Time (UTC)'
                }
              }
            }
          }
        });
      }

      // Initialize everything when page loads
      document.addEventListener('DOMContentLoaded', function() {
        // Small delay to ensure all libraries are loaded
        setTimeout(function() {
          initializeMap();
          initializeRegionalChart();
          initializeTrafficChart();
          initializeHeatmapChart();
        }, 100);
        
        // Update stats periodically
        setInterval(function() {
          const statsElements = document.querySelectorAll('.stats-overlay .text-success, .stats-overlay .text-info, .stats-overlay .text-warning, .stats-overlay .text-primary');
          statsElements.forEach(el => {
            const currentValue = parseInt(el.textContent.replace(/[^0-9]/g, ''));
            const variation = Math.floor(Math.random() * 20) - 10;
            const newValue = Math.max(0, currentValue + variation);
            el.textContent = el.textContent.includes('$') ? '$' + newValue.toLocaleString() : newValue.toLocaleString();
          });
        }, 5000);
      });
    </script>
  </body>
</html>